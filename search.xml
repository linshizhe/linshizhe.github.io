<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[CentOS6.5下搭建vsftpd服务]]></title>
    <url>%2F2017%2F07%2F20%2F%E6%90%AD%E5%BB%BAvsftpd%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[一、文件传输协议文件传输协议(FTP)是为进行文件共享而设计的因特网标准协议。为了能够在复杂多样的操作设备之间解决文件传输问题，于是便有了统一的FTP文件传输协议（File Transfer Protocol），这是一种能够让使用者在互联网中上传、下载文件的传输协议。FTP文件传输协议默认占用了20、21两个端口号，20端口号用于进行数据传输，21端口号用于接受客户端执行的相关FTP命令与参数，FTP服务端普遍更多的应用于内网中，具有易于搭建、方便管理的特点，并且可以借助FTP客户端工具还可以轻松实现文件的多点下载和断点续传技术，FTP协议的传输拓扑如下图所示 二、实验环境服务端：Centos 6.5 (2.6.32-358.el6.x86_64) ip:192.168.198.141 客户端：Centos 6.5 （2.6.32-431.el6.x86_64） ip：192.168.198.100 selinux =disable [root@vsftpdserver ~]# vi /etc/sysconfig/selinux SELINUX=disabled iptables防火墙管理工具中默认禁止了ftp传输协议的端口号，因此在正式配置vsftpd服务程序前还需要清空一下iptables防火墙的默认策略，并把当前已经被清理的防火墙策略状态保存下来： [root@vsftpdserver ~]# iptables -F [root@vsftpdserver ~]# service iptables save iptables: Saving firewall rules to /etc/sysconfig/iptables:[ OK ] 三、安装软件1）服务端：vsftpd [root@vsftpdserver ~]# yum -y install vsftpd [root@vsftpdserver ~]# rpm -aq|grep vsftpd vsftpd-2.2.2-24.el6.x86_64 2)客户端：ftp [root@ip-ftp_client ~]# yum -y install ftp [root@ip-ftp_client ~]# rpm -aq|grep ftp ftp-0.17-54.el6.x86_64 3）vsftpd服务程序的主配置文件中常用的参数及作用介绍 参数 作用 listen=[YES|NO] 是否以独立运行的方式监听服务。 listen_address=IP地址 设置要监听的IP地址。 listen_port=21 设置FTP服务的监听端口。 download_enable＝[YES|NO] 是否允许下载文件。 userlist_enable=[YES|NO] 是否启用“禁止登陆用户名单”。 userlist_deny=[YES|NO] 是否启用“禁止登陆用户名单”。 max_clients=0 最大客户端连接数，0为不限制。 max_per_ip=0 同一IP地址最大连接数，0为不限制。 anonymous_enable=[YES|NO] 是否允许匿名用户访问。 anon_upload_enable=[YES|NO] 是否允许匿名用户上传文件。 anon_umask=022 匿名用户上传文件的umask值。 anon_root=/var/ftp 匿名用户的FTP根目录。 anon_mkdir_write_enable=[YES|NO] 是否允许匿名用户创建目录。 anon_other_write_enable=[YES|NO] 是否开放匿名用户其他写入权限。 anon_max_rate=0 匿名用户最大传输速率(字节)，0为不限制。 local_enable=[YES|NO] 是否允许本地用户登陆FTP。 local_umask=022 本地用户上传文件的umask值。 local_root=/var/ftp 本地用户的FTP根目录。 chroot_local_user=[YES|NO] 是否将用户权限禁锢在FTP目录，更加的安全。 local_max_rate=0 本地用户最大传输速率(字节)，0为不限制。 四、配置vsftpdvsftpd作为更加安全的FTP文件传输协议的服务程序，可以让用户分别通过匿名开放、本地用户和虚拟用户三种身份验证方式来登陆到FTP服务器上面。 1) 匿名访问模式 [root@vsftpdserver ~]# mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak [root@vsftpdserver ~]# grep -v &quot;#&quot; /etc/vsftpd/vsftpd.conf_bak &gt; /etc/vsftpd/vsftpd.conf [root@vsftpdserver ~]# cat /etc/vsftpd/vsftpd.conf anonymous_enable=YES local_enable=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES pam_service_name=vsftpd userlist_enable=YES tcp_wrappers=YES 修改vsftpd.conf配置 [root@vsftpdserver ~]# vi /etc/vsftpd/vsftpd.conf anonymous_enable=YES anon_umask=022 anon_upload_enable=YES anon_mkdir_write_enable=YES anon_other_write_enable=YES local_enable=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES pam_service_name=vsftpd userlist_enable=YES tcp_wrappers=YES 保存配置后重启服务，并设置服务开机自启动 [root@vsftpdserver ~]# service vsftpd restart Shutting down vsftpd: [FAILED] Starting vsftpd for vsftpd: [ OK ] [root@vsftpdserver ~]# chkconfig vsftpd on 在客户端测试： [root@ip-ftp_client ~]# ftp 192.168.198.141 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): anonymous （用户名anonymous） 331 Please specify the password. Password: （此次直接回车） 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; cd到pub目录，创建一个SYS目录 ftp&gt; cd pub 250 Directory successfully changed. ftp&gt; mkdir SYS 550 Create directory operation failed. 我们看到mkdir SYS 提示550 Create directory operation failed.（？？？fuck,什么原因？？，前面我们设置 了anon_mkdir_write_enable=YES)，原来FTP服务的匿名开放模式是默认登陆到了/var/ftp目录中，查看下这个目录的权限后才发现原来只有root管理员用户才有写入权限的，怪不得会提示写入出错呢，只需要把目录的所有者身份改成系统帐户ftp即可，这样就应该可以了~ [root@vsftpdserver ~]# ls -ld /var/ftp/pub drwxr-xr-x. 6 root root 4096 Mar 22 12:14 /var/ftp/pub [root@vsftpdserver ~]# chown -Rf ftp /var/ftp/pub [root@vsftpdserver ~]# ls -ld /var/ftp/pub drwxr-xr-x. 6 ftp root 4096 Mar 22 12:14 /var/ftp/pub 然后再创建几个目录看看行不行 ftp&gt; cd pub 250 Directory successfully changed. ftp&gt; mkdir SYS 257 &quot;/pub/SYS&quot; created ftp&gt; mkdir NET 257 &quot;/pub/NET&quot; created ftp&gt; mkdir CWB 257 &quot;/pub/CWB&quot; created ftp&gt; 回到服务端查看目录： [root@vsftpdserver ~]# cd /var/ftp/pub [root@vsftpdserver pub]# ll total 12 drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:35 CWB drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:35 NET drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:35 SYS 客户端上传文件： ftp&gt; cd /pub/SYS 250 Directory successfully changed. ftp&gt; put sys.text local: sys.text remote: sys.text 227 Entering Passive Mode (192,168,198,141,95,201). 150 Ok to send data. 226 Transfer complete. ftp&gt; cd /pub/NET 250 Directory successfully changed. ftp&gt; put net.text local: net.text remote: net.text 227 Entering Passive Mode (192,168,198,141,73,52). 150 Ok to send data. 226 Transfer complete. ftp&gt; cd /pub/CWB 250 Directory successfully changed. ftp&gt; put cwb.text local: cwb.text remote: cwb.text 227 Entering Passive Mode (192,168,198,141,121,92). 150 Ok to send data. 226 Transfer complete 服务端查看： [root@vsftpdserver pub]# cd NET [root@vsftpdserver NET]# ll total 0 -rw-r--r-- 1 ftp ftp 0 Jul 19 20:46 net.text 客户端测试下载： 现在服务端创建一个iphone.txt的文件 [root@vsftpdserver ~]# cd /var/ftp/pub [root@vsftpdserver pub]# touch iphone.txt [root@vsftpdserver pub]# ll total 12 drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:46 CWB -rw-r--r-- 1 root root 0 Jul 19 20:53 iphone.txt drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:46 NET drwxr-xr-x 2 ftp ftp 4096 Jul 19 20:45 SYS 客户端下载： ftp&gt; get iphone.txt local: iphone.txt remote: iphone.txt 227 Entering Passive Mode (192,168,198,141,213,175). 150 Opening BINARY mode data connection for iphone.txt (0 bytes). 226 Transfer complete. 下载到对应目录 [root@ip-ftp_client iphone]# ll 总用量 0 -rw-r--r-- 1 root root 0 7月 18 16:56 iphone.txt 2）本地用户模式 本地用户模式是通过Linux系统本地的帐号密码信息进行的验证方式，这种模式相比较匿名开放模式来说比较安全，因此推荐既然开启了本地用户模式，就把匿名开放模式给关闭了吧~ a)编辑配置文件vsftpd.conf [root@vsftpdserver ~]# vi /etc/vsftpd/vsftpd.conf anonymous_enable=NO local_enable=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES pam_service_name=vsftpd userlist_enable=YES tcp_wrappers=YES b)修改默认端口 默认FTP服务器端口号是21，出于安全目的，有时需修改默认端口号，修改/etc/vsftpd/vsftpd.conf，添加语句(例)：listen_port=4449 [root@vsftpdserver ~]# vi /etc/vsftpd/vsftpd.conf listen_port=4449 c)重启服务，并设置开机自启 [root@vsftpdserver ~]# service vsftpd restart Shutting down vsftpd: [ OK ] Starting vsftpd for vsftpd: [ OK ] d)设置用户组 递归创建新目录 [root@vsftpdserver ~]# mkdir -p /home/SYS 新建组 [root@vsftpdserver ~]# groupadd SYS 新建用户SYS-01、SYS-02、SYS-03并指定家目录和属组 [root@vsftpdserver ~]# useradd -g SYS -d /home/SYS SYS-01 [root@vsftpdserver ~]# useradd -g SYS -d /home/SYS SYS-02 [root@vsftpdserver ~]# useradd -g SYS -d /home/SYS SYS-03 为新用户SYS-01、SYS-02、SYS-03设密码 （baidu.com@ip） [root@vsftpdserver ~]# passwd SYS-01 Changing password for user SYS-01. New password: Retype new password: passwd: all authentication tokens updated successfully. [root@vsftpdserver ~]# passwd SYS-02 Changing password for user SYS-02. New password: Retype new password: passwd: all authentication tokens updated successfully. [root@vsftpdserver ~]# passwd SYS-03 Changing password for user SYS-03. New password: Retype new password: passwd: all authentication tokens updated successfully. 设置目录属主为用户SYS-01 [root@vsftpdserver ~]# chown SYS-01 /home/SYS 设置目录属组为组SYS [root@vsftpdserver ~]# chown .SYS /home/SYS 设置目录访问权限SYS-01为读，写，执行；SYS-02，SYS-03为读，执行 [root@vsftpdserver ~]# chmod 750 /home/SYS 使用SYS-01登陆到服务端：分别执行创建目录文件、重命名文件以及删除目录文件 [root@ip-ftp_client ~]# ftp 192.168.198.141 4449 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): SYS-01 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; cd /home/SYS 250 Directory successfully changed. ftp&gt; mkdir SYS-01 257 &quot;/home/SYS/SYS-01&quot; created ftp&gt; rename SYS-01 SYS-01_database 350 Ready for RNTO. 250 Rename successful. ftp&gt; rmdir SYS-01_database 250 Remove directory operation successful. 使用SYS-02登陆到服务端：分别执行创建目录文件、重命名文件以及删除目录文件 [root@ip-ftp_client ~]# ftp 192.168.198.141 4449 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): SYS-02 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; ls 227 Entering Passive Mode (192,168,198,141,228,42). 150 Here comes the directory listing. -rw-r--r-- 1 0 0 0 Jul 19 22:08 sys_log 226 Directory send OK. tp&gt; mkdir SYS-02 550 Create directory operation failed. 使用SYS-03登陆到服务端：分别执行创建目录文件、重命名文件以及删除目录文件 root@ip-ftp_client ~]# ftp 192.168.198.141 4449 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): SYS-03 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; cd /home/SYS 250 Directory successfully changed. ftp&gt; ls 227 Entering Passive Mode (192,168,198,141,178,100). 150 Here comes the directory listing. -rw-r--r-- 1 0 0 0 Jul 19 22:08 sys_log 226 Directory send OK. ftp&gt; mkdir SYS-03 550 Create directory operation failed. 由于本地用户登录FTP服务器后进入自己主目录，而SYS-01,SYS-02 SYS-03对主目录/home/SYS分配的权限不同，所以通过FTP访问的权限也不同，SYS-01访问权限为：上传，下载，建目录；SYS-02，SYS-03访问权限为下载，浏览，不能建目录和上传。实现了群组中用户不同访问级别，加强了对FTP服务器的分级安全管理。 3）虚拟用户模式 虚拟用户模式是一种相比较来说最为安全的验证方式，需要为FTP传输服务单独建立用户数据库文件，虚拟出用来口令验证的帐户信息，这些帐号是在服务器系统中不存在的，仅供FTP传输服务做验证使用，因此这样即便骇客破解出了帐号口令密码后也无法登录到服务器主机上面，有效的降低了破坏范围和影响。所以只要在配置妥当合理的情况下，虚拟用户模式要比前两种验证方式更加的安全，同时配置的流程也稍微会复杂一些。 第一步：创建用于进行FTP验证的帐号密码数据库文件，单数行为账户名，偶数行为密码，例如分别创建出support-01和support-02两个用户，密码均为baidu.com@ip [root@vsftpdserver SYS]# cd /etc/vsftpd/ [root@vsftpdserver vsftpd]# vi vuser.list support-01 baidu.com@ip support-02 baidu.com@ip 明文信息既不安全，也不能让vsftpd服务程序直接读取，因此需要使用db_load命令用HASH算法将这个原始的明文信息文件转换成数据库文件，并且再把数据库文件权限调小一些（避免其他人能看到数据库文件的内容），然后再把原始的明文信息文件删除掉。 [root@vsftpdserver vsftpd]# db_load -T -t hash -f vuser.list vuser.db [root@vsftpdserver vsftpd]# file vuser.db vuser.db: Berkeley DB (Hash, version 9, native byte-order) [root@vsftpdserver vsftpd]# chmod 600 vuser.db [root@vsftpdserver vsftpd]# rm -f vuser.list 第2步：创建用于FTP服务存储文件的根目录以及虚拟用户映射的系统本地用户，FTP服务存储文件的根目录指的是当虚拟用户登陆后默认所在的位置，但在Linux系统中的每一个文件都是有所有者和所有组属性的，例如用support-01帐户创建了一个新文件，但是support-01这个用户在系统中是找不到的，就会导致Linux系统中这个文件权限出现错误。因此还需要再创建一个用来让虚拟用户映射的系统本地用户，简单来说就是让虚拟用户默认登陆到这个本地用户的家目录中，创建的文件属性也都归属于这个本地用户，避免本地Linux系统无法处理这种虚拟用户创建的文件属性权限。为了方便管理FTP资料，可以把这个用于虚拟用户映射的系统本地用户的家目录设置到/var目录中（因为该目录是用来存放经常发生改变的数据），并且为了安全起见把这个系统本地用户的终端设置成不允许登陆，这不会影响虚拟用户的使用 。 [root@vsftpdserver vsftpd]# useradd -d /var/ftproot -s /sbin/nologin virtual [root@vsftpdserver vsftpd]# ls -ld /var/ftproot/ drwx------ 4 virtual virtual 4096 Jul 19 22:38 /var/ftproot/ [root@vsftpdserver vsftpd]# chmod -Rf 755 /var/ftproot/ 第3步：建立用于支持虚拟用户的PAM认证文件 [root@vsftpdserver vsftpd]# vi /etc/pam.d/vsftpd.vu auth required pam_userdb.so db=/etc/vsftpd/vuser account required pam_userdb.so db=/etc/vsftpd/vuser 第4步：在vsftpd服务程序主配置文件中修改PAM支持文件 [root@vsftpdserver vsftpd]# vi /etc/vsftpd/vsftpd.confanonymous_enable=NO local_enable=YES guest_enable=YES guest_username=virtual allow_writeable_chroot=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES listen_port=4449 pam_service_name=vsftpd.vu userlist_enable=YES tcp_wrappers=YES 第5步：为虚拟用户设置不同的权限，虽然support-01和support-02两个帐户都是用于FTP服务验证的虚拟帐户，但也想在他们之间区别对待。比如只允许support-01用户能够上传、创建、修改、查看、删除文件，而support-02只能查看文件，这其实也是可以让vsftpd服务程序实现的，只需要新建一个目录，在里面分别创建两个以support-01和support-02命名的文件，其中在support-01命名的文件中写入相关允许的权限 [root@vsftpdserver vsftpd]# mkdir /etc/vsftpd/vusers_dir/ [root@vsftpdserver vsftpd]# cd /etc/vsftpd/vusers_dir/ [root@vsftpdserver vusers_dir]# touch support-02 [root@vsftpdserver vusers_dir]# vi support-01 anon_upload_enable=YES anon_mkdir_write_enable=YES anon_other_write_enable=YES 再次修改下vsftpd主配置文件，添加user_config_dir参数来定义这两个虚拟用户不同权限的配置文件所存放的路径即可，为了让刚刚配置的服务程序新参数立即生效，需要把vsftpd再来重新启动一下，并加入到开机启动项中。 [root@vsftpdserver vusers_dir]# vi /etc/vsftpd/vsftpd.conf anonymous_enable=NO local_enable=YES guest_enable=YES guest_username=virtual allow_writeable_chroot=YES pam_service_name=vsftpd.vu write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES user_config_dir=/etc/vsftpd/vusers_dir listen_port=4449 userlist_enable=YES tcp_wrappers=YES [root@vsftpdserver vusers_dir]# service vsftpd restart Shutting down vsftpd: [ OK ] Starting vsftpd for vsftpd: [ OK ] [root@vsftpdserver vusers_dir]# chkconfig vsftpd on 客户端测试登陆support-02： [root@ip-ftp_client ~]# ftp 192.168.198.141 4449 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): support-02 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; mkdir support-02 550 Permission denied. 客户端测试登陆support-01： [root@ip-ftp_client ~]# ftp 192.168.198.141 4449 Connected to 192.168.198.141 (192.168.198.141). 220 (vsFTPd 2.2.2) Name (192.168.198.141:root): support-01 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; mkdir support-01 257 &quot;/support-01&quot; created ftp&gt; rename support-01 support-01_log 350 Ready for RNTO. 250 Rename successful. ftp&gt; rmdir support-01_log 250 Remove directory operation successful.]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>Vsftpd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux禁止ping以及开启ping的方法]]></title>
    <url>%2F2017%2F07%2F19%2FLinux%E7%A6%81%E6%AD%A2ping%E4%BB%A5%E5%8F%8A%E5%BC%80%E5%90%AFping%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[Linux默认是允许Ping响应的，系统是否允许Ping由2个因素决定的： 1）内核参数 2）防火墙 需要2个因素同时允许才能允许Ping，2个因素有任意一个禁Ping就无法Ping。 第一种设置内核参数： 1）允许ping : a:临时允许PING配置 [root@CCIELAB lszlab]# echo 0 &gt;/proc/sys/net/ipv4/icmp_echo_ignore_all b:永久允许PING配置 编辑/etc/sysctl.conf 文件 加入 net.ipv4.icmp_echo_ignore_all=0 [root@CCIELAB lszlab]# vi /etc/sysctl.conf #ping （0表示允许，1表示禁止） net.ipv4.icmp_echo_ignore_all=0 修改完成使用sysctl -p使其新配置生效 [root@CCIELAB lszlab]# sysctl -p net.ipv4.ip_forward = 0 net.ipv4.conf.default.rp_filter = 1 net.ipv4.conf.default.accept_source_route = 0 kernel.sysrq = 0 kernel.core_uses_pid = 1 net.ipv4.tcp_syncookies = 1 error: &quot;net.bridge.bridge-nf-call-ip6tables&quot; is an unknown key error: &quot;net.bridge.bridge-nf-call-iptables&quot; is an unknown key error: &quot;net.bridge.bridge-nf-call-arptables&quot; is an unknown key kernel.msgmnb = 65536 kernel.msgmax = 65536 kernel.shmmax = 68719476736 kernel.shmall = 4294967296 net.ipv4.icmp_echo_ignore_all = 0 2）禁止Ping： a：临时禁止PING配置： [root@CCIELAB lszlab]# echo 1 &gt;/proc/sys/net/ipv4/icmp_echo_ignore_all 禁止ping 前 [qd01@ip-CentOS-6 ~]$ ping -c 3 192.168.198.141 PING 192.168.198.141 (192.168.198.141) 56(84) bytes of data. 64 bytes from 192.168.198.141: icmp_seq=1 ttl=64 time=0.291 ms 64 bytes from 192.168.198.141: icmp_seq=2 ttl=64 time=0.484 ms 64 bytes from 192.168.198.141: icmp_seq=3 ttl=64 time=0.475 ms --- 192.168.198.141 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2002ms rtt min/avg/max/mdev = 0.291/0.416/0.484/0.092 ms 禁止ping 后 PING 192.168.198.141 (192.168.198.141) 56(84) bytes of data. --- 192.168.198.141 ping statistics --- 3 packets transmitted, 0 received, 100% packet loss, time 12002ms b:永久禁止PING配置 编辑/etc/sysctl.conf 文件 加入 net.ipv4.icmp_echo_ignore_all=1 [root@CCIELAB lszlab]# vi /etc/sysctl.conf #ping （0表示允许，1表示禁止） net.ipv4.icmp_echo_ignore_all=1 修改完成使用sysctl -p使其新配置生效 [root@CCIELAB lszlab]# sysctl -p net.ipv4.ip_forward = 0 net.ipv4.conf.default.rp_filter = 1 net.ipv4.conf.default.accept_source_route = 0 kernel.sysrq = 0 kernel.core_uses_pid = 1 net.ipv4.tcp_syncookies = 1 error: &quot;net.bridge.bridge-nf-call-ip6tables&quot; is an unknown key error: &quot;net.bridge.bridge-nf-call-iptables&quot; is an unknown key error: &quot;net.bridge.bridge-nf-call-arptables&quot; is an unknown key kernel.msgmnb = 65536 kernel.msgmax = 65536 kernel.shmmax = 68719476736 kernel.shmall = 4294967296 net.ipv4.icmp_echo_ignore_all = 1 第二种：设置防火墙： 内核配置是默认值，也就是没有禁止Ping下进行设置 1）允许ping 操作 [root@CCIELAB lszlab]# iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT [root@CCIELAB lszlab]# iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT 或者临时关闭防火墙： [root@CCIELAB lszlab]# service iptables stop iptables: Flushing firewall rules: [ OK ] iptables: Setting chains to policy ACCEPT: filter [ OK ] iptables: Unloading modules: [ OK ] 2）禁止ping操作 [root@CCIELAB lszlab]# iptables -A INPUT -p icmp --icmp-type 8 -s 0/0 -j DROP]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>ping</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[在Ubuntu Server下搭建LAMP环境]]></title>
    <url>%2F2017%2F07%2F17%2F%E5%9C%A8Ubuntu%20Server%E4%B8%8B%E6%90%AD%E5%BB%BALAMP%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[一、前言1.1LAMP详解经过多年是Web技术发展，在业内被广泛使用的一种Web服务器解决方案之一（LNMP也非常受欢迎），由一些独立的系统或软件组合而成。 软件组件： Linux: Linux 是免费开源软件，这意味着源代码可用的操作系统。 Apache: Apache 是使用中最受欢迎的一个开放源码的WEB服务器软件。 MySQL: MySQL 是多线程、多用户的SQL数据库管理系统。 PHP: PHP 是一种编程语言最初设计生产动态网站。PHP 是主要用于服务器端的应用程序软件。Perl 和 Python 类似。 1.2LAMP工作原理 二、实验环境：发行版本: Ubuntu 12.04.5 LTS 内核版本：3.13.0-32-generic ip:192.168.198.5 三、Ubuntu server 管理员权限解读为了安全Ubuntu 官方不推荐使用root账户远程登陆，安装系统的时候会强制要设置一个不同于root的普通用户。 操作ubuntu的预备知识： 1）命令行 dgnet@dgnet-ip:~$ dgnet表示用户名 @dgnet-ip 表示@主机名 ~ 表示当前目录 $ 表示用户类型标记 -$表示普通用户，#表示超级管理员 2）通过passwd命令修改账户密码 2.1）先查看当前用户 dgnet@dgnet-ip:~$ pwd /home/dgnet 2.2）让当前用户获得临时超级管理员权限 dgnet@dgnet-ip:~$ sudo passwd root [sudo] password for dgnet: #输入用户dgnet的秘密 Enter new UNIX password: #给root用户设置新密码 Retype new UNIX password: #确认root密码 passwd: password updated successfully 注意事项： 1）普通账户没有管理员权限 2）默认情况下ROOT账户无法登陆 3）su (switch user)切换到超级管理员 4）sudo (switch user and do) 以超级管理员身份执行 5）sudo弥补了su产生的多账户安全问题 使用su命令所有管理员都必须知道root账户的密码，sudo使得普通管理员使用自己的秘密也可以获得超级管理员权限。 四、安装软件1）先安装apt-get软件安装工具 gnet@dgnet-ip:~$ sudo apt-get update 2) 使用apt-get软件安装工具安装apache2 dgnet@dgnet-ip:~$ sudo apt-get install apache2 检查一下apache的版本 dgnet@dgnet-ip:~$ apache2 -v Server version: Apache/2.2.22 (Ubuntu) Server built: Jul 15 2016 15:32:45 打开浏览器输入ip地址检查apache是否正常工作 3)使用apt-get软件安装工具安装php5 dgnet@dgnet-ip:~$ sudo apt-get install php5 检查一下php的版本 dgnet@dgnet-ip:~$ php5 -v PHP 5.3.10-1ubuntu3.26 with Suhosin-Patch (cli) (built: Feb 13 2017 20:37:53) Copyright (c) 1997-2012 The PHP Group Zend Engine v2.3.0, Copyright (c) 1998-2012 Zend Technologies 检查一下apache是否加载了libphp5.so这个模块 dgnet@dgnet-ip:~$ cat /etc/apache2/mods-enabled/php5.load LoadModule php5_module /usr/lib/apache2/modules/libphp5.so 4)使用apt-get软件安装工具安装mysql-server dgnet@dgnet-ip:~$ sudo apt-get install mysql-server 先给mysql-server设置密码（baidu.com@ip） 接着安装一下mysql的扩展 dgnet@dgnet-ip:~$ sudo apt-get install php5-mysql 检查一下mysql.so模块是否正常加载 dgnet@dgnet-ip:~$ cat /etc/php5/conf.d/mysql.ini ; configuration for php MySQL module extension=mysql.so 确保php5与mysql能正常工作，重启一下mysql dgnet@dgnet-ip:~$ sudo service mysql restart 重启apache dgnet@dgnet-ip:~$ sudo service mysql restart 到目前lamp软件已经安装完成，分开各个软件安装是为了更好了理解各个软件之间的关系，我们清楚了解了lamp之后可以使用一条命令就把lamp安装好。 dgnet@dgnet-ip:~$ sudo apt-get install -y apache2 php5 mysql-server php5-mysql 或者 dgnet@dgnet-ip:~$ sudo tasksel install -y lamp-servver 五、其他设置1）创建phpinfo服务器探针 dgnet@dgnet-ip:~$ cd /var/www dgnet@dgnet-ip:/var/www$ sudo vim info.php [sudo] password for dgnet: info.php代码 &lt;?phpecho mysql_connect(&apos;localhost&apos;,&apos;root&apos;,&apos;baidu.com@ip&apos;) ? &apos;Mom, dont worry about my database, either&apos; : &apos;Last year I bought a watch&apos;; phpinfo(); 在浏览器中打开info.php查看,php与数据库是否正常 2)PHP添加常用扩展 dgnet@dgnet-ip:~$ sudo apt-get install php5-gd curl libcurl3-dev php5-curl 安装完成重启apache dgnet@dgnet-ip:~$ sudo service apache2 restart 浏览器中查看扩展是否工作正常 六、LAMP环境配置文件1）Ubuntu系统配置文件目录：/etc 2)各组件配置文件位置 -Apache /etc/apache2 -MYSQL /etc/mysql -PHP /etc/php5 3)查看apache dgnet@dgnet-ip:~$ cd /etc/apache2 dgnet@dgnet-ip:/etc/apache2$ ll apache工作过程： apache核心配置： -mods-* Apache模块 -sites-* 虚拟主机 关键词 available 可以使用的；enabled 已启用的 4)MYSQL核心配置文件 my.cnf 5)php核心配置文件 php.ini 6)配置apache虚拟主机 7)手动模拟DNS，修改本地hosts文件 浏览器查看上面三个域名，都是指向ip 192.168.198.5 8)为（oa bbs video）服务器创建目录 dgnet@dgnet-ip:~$ cd /var dgnet@dgnet-ip:/var$ sudo mkdir -p /wwwroot/{video,bbs,oa} dgnet@dgnet-ip:/var$ cd /wwwroot/ dgnet@dgnet-ip:/wwwroot$ ll dgnet@dgnet-ip:/wwwroot$ cd video/ dgnet@dgnet-ip:/wwwroot/video$ sudo vim index.html dgnet@dgnet-ip:/wwwroot/video$ cd ../bbs dgnet@dgnet-ip:/wwwroot/bbs$ sudo vim index.html dgnet@dgnet-ip:/wwwroot$ cd oa dgnet@dgnet-ip:/wwwroot/oa$ sudo vim index.html 9）开始配置虚拟主机 dgnet@dgnet-ip:/wwwroot/oa$ cd /etc/apache2/sites-available/ dgnet@dgnet-ip:/etc/apache2/sites-available$ ll ls: 初始化月份字符串出错 总用量 20 drwxr-xr-x 2 root root 4096 7Ղ 17 15:00 ./ drwxr-xr-x 7 root root 4096 7Ղ 17 15:00 ../ -rw-r--r-- 1 root root 950 2Ղ 7 2012 default -rw-r--r-- 1 root root 7469 2Ղ 7 2012 default-ssl 复制defult文件作为video bbs oa 三个虚拟主机的蓝本 dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo cp default video dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo cp default bbs dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo cp default oa 编辑video dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo vim video 虚拟配置如下： &lt;VirtualHost *:80&gt; ServerName video.lsz.com ServerAdmin webmaster@localhost DocumentRoot /wwwroot/video &lt;Directory /&gt; Options FollowSymLinks AllowOverride None &lt;/Directory&gt; &lt;Directory /wwwroot/video/&gt; Options Indexes FollowSymLinks MultiViews AllowOverride None Order allow,deny allow from all &lt;/Directory&gt; 编辑bbs: dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo vim bbs 虚拟配置如下： &lt;VirtualHost *:80&gt; ServerName bbs.lsz.com ServerAdmin webmaster@localhost DocumentRoot /wwwroot/bbs &lt;Directory /&gt; Options FollowSymLinks AllowOverride None &lt;/Directory&gt; &lt;Directory /wwwroot/bbs/&gt; Options Indexes FollowSymLinks MultiViews AllowOverride None Order allow,deny allow from all &lt;/Directory&gt; 编辑oa: dgnet@dgnet-ip:/etc/apache2/sites-available$ sudo vim oa 虚拟配置如下： &lt;VirtualHost *:80&gt; ServerName oa.lsz.com ServerAdmin webmaster@localhost DocumentRoot /wwwroot/oa &lt;Directory /&gt; Options FollowSymLinks AllowOverride None &lt;/Directory&gt; &lt;Directory /wwwroot/oa/&gt; Options Indexes FollowSymLinks MultiViews AllowOverride None Order allow,deny allow from all &lt;/Directory&gt; 10)启用虚拟配置文件 dgnet@dgnet-ip:/etc/apache2/sites-available$ cd ../sites-enabled/ dgnet@dgnet-ip:/etc/apache2/sites-enabled$ sudo ln -s ../sites-available/video video dgnet@dgnet-ip:/etc/apache2/sites-enabled$ sudo ln -s ../sites-available/bbs bbs dgnet@dgnet-ip:/etc/apache2/sites-enabled$ sudo ln -s ../sites-available/oa oa dgnet@dgnet-ip:/etc/apache2/sites-enabled$ ll ls: 初始化月份字符串出错 总用量 8 drwxr-xr-x 2 root root 4096 7Ղ 17 18:14 ./ drwxr-xr-x 7 root root 4096 7Ղ 17 15:00 ../ lrwxrwxrwx 1 root root 26 7Ղ 17 15:00 000-default -&gt; ../sites-available/default lrwxrwxrwx 1 root root 22 7Ղ 17 18:14 bbs -&gt; ../sites-available/bbs lrwxrwxrwx 1 root root 21 7Ղ 17 18:14 oa -&gt; ../sites-available/oa lrwxrwxrwx 1 root root 24 7Ղ 17 18:14 video -&gt; ../sites-available/video dgnet@dgnet-ip:/etc/apache2/sites-enabled$ sudo service apache2 restart 浏览器中查看对应的域名： bbs.lsz.com video.lsz.com oa.lsz.com 11）安装数据库管理工具phpmyadmin dgnet@dgnet-ip:~$ sudo apt-get install phpmyadmin dgnet@dgnet-ip:~$ cd /var/www dgnet@dgnet-ip:/var/www$ sudo ln -s /usr/share/phpmyadmin phpmyadmin 浏览器打开 开启MySQL的remote access dgnet@dgnet-ip:/var/www$ sudo vim /etc/mysql/my.cnf 找到bind-address注释 #bind-address = 127.0.0.1 使用phpmyadmin用户密码登陆 (root,baidu.com@ip) 添加一个用户linshizhe 允许公网ip 访问 重启mysql重新加载配置： dgnet@dgnet-ip:/var/www$ sudo service mysql restart 通过Navicat测试远程连接数据库 到这里lamp基本就已经部署完成了！！！]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>LAMP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 6.5下PXE+Kickstart无人值守安装操作系统]]></title>
    <url>%2F2017%2F07%2F15%2FPXE%2BKickstart%2F</url>
    <content type="text"><![CDATA[一、前言1.1什么是PXEPXE(Pre-boot Execution Environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端基本软件设置，从而引导预先安装在服务器中的终端操作系统。严格来说，PXE 并不是一种安装方式，而是一种引导方式。进行 PXE 安装的必要条件是在要安装的计算机中必须包含一个 PXE 支持的网卡（NIC），即网卡中必须要有 PXE Client。PXE 协议可以使计算机通过网络启动。此协议分为 Client端和 Server 端，而PXE Client则在网卡的 ROM 中。当计算机引导时，BIOS 把 PXE Client 调入内存中执行，然后由 PXE Client 将放置在远端的文件通过网络下载到本地运行。运行 PXE 协议需要设置 DHCP 服务器和 TFTP 服务器。DHCP 服务器会给 PXE Client（将要安装系统的主机）分配一个 IP 地址，由于是给 PXE Client 分配 IP 地址，所以在配置 DHCP 服务器时需要增加相应的 PXE 设置。此外，在 PXE Client 的 ROM 中，已经存在了 TFTP Client，那么它就可以通过 TFTP 协议到 TFTP Server 上下载所需的文件了。 pxe的工作过程： PXE Client 从自己的PXE网卡启动，向本网络中的DHCP服务器索取IP； DHCP 服务器返回分配给客户机的IP 以及PXE文件的放置位置(该文件一般是放在一台TFTP服务器上) ； PXE Client 向本网络中的TFTP服务器索取pxelinux.0 文件； PXE Client 取得pxelinux.0 文件后之执行该文件； 根据pxelinux.0 的执行结果，通过TFTP服务器加载内核和文件系统 ； 进入安装画面, 此时可以通过选择HTTP、FTP、NFS 方式之一进行安装；详细工作流程，请参考下面这幅图： 1.2初认KickstartKickstart是一种无人值守的安装方式。它的工作原理是在安装过程中记录典型的需要人工干预填写的各种参数，并生成一个名为ks.cfg的文件。如果在安装过程中（不只局限于生成Kickstart安装文件的机器）出现要填写参数的情况，安装程序首先会去查找Kickstart生成的文件，如果找到合适的参数，就采用所找到的参数；如果没有找到合适的参数，便需要安装者手工干预了。所以，如果Kickstart文件涵盖了安装过程中可能出现的所有需要填写的参数，那么安装者完全可以只告诉安装程序从何处取ks.cfg文件，然后就去忙自己的事情。等安装完毕，安装程序会根据ks.cfg中的设置重启系统，并结束安装。 PXE+Kickstart 无人值守安装操作系统完整过程如下： 二、系统环境实验环境：VMware Workstation 11 系统平台：CentOS release 6.5 (最小化安装) 网络模式：NAT模式（共享主机的IP地址） DHCP / TFTP IP：192.168.198.3 HTTP / FTP / NFS IP：192.168.198.3 防火墙状态：关闭 #service iptables stop #chkconfig iptables off #service iptables status SELINUX=disabled #vi /etc/sysconfig/selinux 三、准备工作生成ks.cfg 文件需要system-config-kickstart 工具，而此工具依赖于X Windows，所以我们需要安装X Windows 和Desktop 并重启系统，操作如下： #yum groupinstall &quot;X Window System&quot; #yum groupinstall Desktop #reboot 四、配置HTTP安装方式系统的安装方式可以选择HTTP、FTP、 NFS，这里介绍HTTP方式的安装 1）安装http #yum install httpd –y #rpm -qa|grep httpd 2) 开启服务并设置开机启动 #/etc/init.d/httpd start #chkconfig --level 35 httpd on 3)在虚拟机中设置加载ISO镜像 4)将iso文件挂载至/mnt/cdrom #mkdir /mnt/cdrom #mount /dev/cdrom /mnt/cdrom 5)复制光盘全部内容至http 的根目录/var/www/html/ 下 #cp -r /mnt/cdrom/ /var/www/html/ HTTP部分设置完成。 五、配置TFTP1）安装tftp-server #yum install tftp-server –y #grep -qa|grep tftp-server 2)启用tftp服务 #vi /etc/xinetd.d/tftp 3）修改配置文件如下，将disable设置成no service tftp { socket_type = dgram protocol = udp wait = yes user = root server = /usr/sbin/in.tftpd server_args = -s /var/lib/tftpboot disable = no per_source = 11 cps = 100 2 flags = IPv4 } 4）启动tftp服务，因为tftp服务是挂载在超级进程xinetd 下的，所以通过启动xinetd 来启动tftp服务。 #/etc/init.d/xinetd restart 设置开机启动xinetd #chkconfig xinetd on 六、配置支持PXE的启动程序1）复制pxelinux.0 文件至/var/lib/tftpboot/ 文件夹中，（需要先用yum方式安装syslinux） #yum –y install syslinux #cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ 说明：syslinux是一个功能强大的引导加载程序，而且兼容各种介质。更加确切地说：SYSLINUX是一个小型的Linux操作系统，它的目的是简化首次安装Linux的时间，并建立修护或其它特殊用途的启动盘。 2)复制iso镜像中的 /image/pxeboot/initrd.img 和 vmlinux到 /var/lib/tftpboot/ 目录中 #cp /var/www/html/cdrom/images/pxeboot/{initrd.img,vmlinuz} /var/lib/tftpboot/ 3）复制iso镜像中的 /isolinux/*.msg 到 /var/lib/tftpboot/ 目录中 #cp /var/www/html/cdrom/isolinux/*.msg /var/lib/tftpboot/ 4）在/var/lib/tftpboot/ 中新建一个pxelinux.cfg目录 #mkdir /var/lib/tftpboot/pxelinux.cfg 5）将iso 镜像中的/isolinux 目录中的isolinux.cfg复制到pxelinux.cfg目录中，同时更改文件名称为default #cp /var/www/html/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default 6）修改default文件 #vi /var/lib/tftpboot/pxelinux.cfg/default 配置如下： default ks #默认启动的是 &apos;label ks&apos; 中标记的启动内核 prompt 1 #显示 &apos;boot: &apos; 提示符。为 &apos;0&apos; 时则不提示，将会直接启动 &apos;default&apos; 参数中指定的内容。 timeout 6 #在用户输入之前的超时时间，单位为 1/10 秒。 display boot.msg #显示某个文件的内容，注意文件的路径。默认是在/var/lib/tftpboot/ 目录下。也可以指定位类似 &apos;/install/boot.msg&apos;这样的，路径+文件名。 F1 boot.msg #按下 &apos;F1&apos; 这样的键后显示的文件。 F2 options.msg F3 general.msg F4 param.msg F5 rescue.msg label linux #&apos;label&apos; 指定你在 &apos;boot:&apos; 提示符下输入的关键字，比如boot: linux[ENTER]，这个会启动&apos;label linux&apos; 下标记的kernel 和initrd.img 文件。 kernel vmlinuz #kernel 参数指定要启动的内核。 append initrd=initrd.img #append 指定追加给内核的参数，能够在grub 里使用的追加给内核的参数，在这里也都可以使用。 label text kernel vmlinuz append initrd=initrd.img text label ks kernel vmlinuz append ks=http://192.168.198.3/ks.cfg initrd=initrd.img #告诉系统，从哪里获取ks.cfg文件 label local localboot 1 label memtest86 kernel memtest append - 七、配置DHCP1)安装DHCP服务 #yum -y install dhcp 2）复制配置模板文件到DHCP的配置目录中 #cp -f /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample /etc/dhcp/dhcpd.conf 3）修改DHCP配置文件 #vi /etc/dhcp/dhcpd.conf 配置如下： ddns-update-style interim; ignore client-updates; filename &quot;pxelinux.0&quot;; next-server 192.168.198.3; subnet 192.168.198.0 netmask 255.255.255.0 { range dynamic-bootp 192.168.198.10 192.168.198.200; option subnet-mask 255.255.255.0; option routers 192.168.198.3; option broadcast-address 192.168.198.254; default-lease-time 21600; max-lease-time 43200; } 4）启动DHCP服务 #/etc/init.d/dhcpd start 八、生成ks.cfg 文件1）安装Kickstart #yum -y install system-config-kickstart 2）在桌面环境下配置Kickstart，启动X Windows 环境，并配置Kickstart #startx #system-config-kickstart 3）注意事项：system-config-kickstart 启动报错如下 解决方法： #yum -y install glib2-devel 4）设置kickstart参数 设置语言，键盘，时区，Root密码，安装完毕后重启等。 设置安装方式，这篇文章介绍的是HTTP方式的安装，故选择HTTP 设置安装安装MBR 设置磁盘分区 分区规划：这里先测试三个主分区 分区总览 配置网络 认证配置 SELinux 和防火墙配置 图形环境配置 软件包安装选择 预览 生成ks.cfg 文件，保存在/var/www/html/ 文件夹下 打开/var/www/html/ks.cfg 文件进行查看并做修改。 #vi /var/www/html/ks.cfg 配置如下： platform=x86, AMD64, or Intel EM64T #version=DEVEL # Firewall configuration firewall --disabled # Install OS instead of upgrade install # Use network installation url --url=http://192.168.198.3/cdrom/ #这个选项告诉安装程序：到服务器192.168.198.3 的HTTP根目录下的cdrom 文件夹下寻找安装介质 # Root password rootpw --iscrypted $1$vsvtP./e$6PVMNfJd.shq2LgFJjYfA1 # System authorization information auth --useshadow --enablemd5 # Use graphical install graphical firstboot --disable # System keyboard keyboard us # System language lang en_US # SELinux configuration selinux --disabled # Installation logging level logging --level=info # Reboot after installation reboot # System timezone timezone --isUtc Asia/Shanghai # Network information network --bootproto=dhcp --device=eth0 --onboot=on # System bootloader configuration key --skip bootloader --append=&quot;rhgb quiet&quot; --location=mbr --driveorder=sda # Clear the Master Boot Record zerombr # Partition clearing information clearpart --all --initlabel # Disk partitioning information part / --fstype=&quot;ext4&quot; --size=8192 part swap --fstype=&quot;swap&quot; --size=1024 part /home --fstype=&quot;ext4&quot; --size=2048 %packages @base %end 注意事项：key –skip 如果是红帽系统，此选项可以跳过输入序列号过程；如果是CentOS 系列，则可以不保留此项内容；reboot 此选项必须存在，也必须文中设定位置，不然kickstart显示一条消息，并等待用户按任意键后才重新引导；clearpart –all –initlabel 此条命令必须添加，不然系统会让用户手动选择是否清除所有数据，这就需要人为干预了，从而导致自动化过程失败； 九、测试安装1）新建个虚拟机，添加一块500G硬盘，内存1024M够测试用就可以。 2）点击开机按钮，启动虚拟机后，快速按下F12键进入pxe环境 启动虚拟机，选择从网卡启动，DHCP 服务器正在给客户机分配IP地址。 开始下载vmlinuz 和initrd.img 3) 成功安装系统到login界面后，按前面设置的root密码进去查看，分区是否和我们设置的一样 PXE+Kickstart 无人值守安装操作系统环境搭建完毕。]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>Kickstart</tag>
        <tag>PXE</tag>
      </tags>
  </entry>
</search>